{% extends 'base.html' %}

{% block title %}
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç–∞—Ç–µ–π
{% endblock %}

{% block content %}
<div class="container">
	<div class="row align-items-center mb-4">
		<div class="col">
			<h2 class="mb-0">
				{% if current_category %}
				–°—Ç–∞—Ç—å–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: "{{ current_category }}"
				{% else %}
				–í—Å–µ —Å—Ç–∞—Ç—å–∏
				{% endif %}
			</h2>
			<p class="text-muted">–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π –≤ –Ω–∞—à–µ–º –±–ª–æ–≥–µ</p>
		</div>
	</div>

	<div class="card mb-4">
		<div class="card-body">
			<h5 class="card-title">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>

			<div class="categories-nav mb-3">
				<h6>–ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥:</h6>
				<div class="d-flex flex-wrap gap-2">
					<a href="{{ url_for('articles') }}"
						class="btn {% if not current_category %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">
						–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
					</a>
					{% for cat in categories %}
					<a href="{{ url_for('articles_by_category', category=cat) }}"
						class="btn {% if current_category == cat %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">
						{{ cat }}
					</a>
					{% endfor %}
				</div>
			</div>

			<form method="GET" action="{{ url_for('articles') }}" class="row g-3">
				<div class="col-md-8">
					<label for="category_search" class="form-label">–ù–∞–π—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</label>
					<input type="text" class="form-control" id="category_search" name="category"
						value="{{ current_category if current_category else '' }}"
						placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...">
					<div class="form-text">
						–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
						{% for cat in categories %}
						<span class="badge bg-secondary me-1">{{ cat }}</span>
						{% endfor %}
					</div>
				</div>
				<div class="col-md-4 d-flex align-items-end">
					<div class="btn-group w-100">
						<button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
						{% if current_category %}
						<a href="{{ url_for('articles') }}" class="btn btn-outline-danger" title="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä">
							–•
						</a>
						{% endif %}
					</div>
				</div>
			</form>
		</div>
	</div>

	{% if articles %}
	<div class="row">
		{% for article in articles %}
		<div class="col-12 mb-4">
			<div class="card news-card h-100 shadow-sm">
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-start mb-2">
						<h5 class="card-title mb-0">{{ article.title }}</h5>
						{% if article.date.date() == today %}
						<span class="badge bg-success ms-2 new-badge">–ù–û–í–û–ï</span>
						{% endif %}
					</div>

					<div class="d-flex justify-content-between align-items-center mb-3">
						<p class="card-text text-muted small mb-0">
							<i class="bi bi-calendar3"></i> {{ article.date.strftime('%d.%m.%Y –≤ %H:%M') }}
						</p>
						<div>
							{% if article.author %}
							<span class="card-text text-muted small me-3">
								–ê–≤—Ç–æ—Ä: {{ article.author }}
							</span>
							{% endif %}
							<span class="badge bg-info">{{ article.category }}</span>
						</div>
					</div>

					<p class="card-text mb-3">{{ article.preview }}</p>

					<div class="row align-items-center">
						<div class="col-md-6">
							<a href="{{ url_for('news', id=article.id) }}" class="btn btn-primary btn-sm">
								–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Üí
							</a>
						</div>
						<div class="col-md-6 text-md-end mt-2 mt-md-0">
							<a href="{{ url_for('edit_article', id=article.id) }}"
								class="btn btn-outline-warning btn-sm me-1">
								‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
							</a>
							<form action="{{ url_for('delete_article', id=article.id) }}" method="POST" class="d-inline"
								onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é?')">
								<button type="submit" class="btn btn-outline-danger btn-sm">
									üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
	{% else %}
	<div class="text-center py-5">
		{% if current_category %}
		<h4>–í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "{{ current_category }}" –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π</h4>
		<p class="text-muted">
			–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏
			<a href="{{ url_for('articles') }}">–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å—Ç–∞—Ç—å–∏</a>
		</p>
		{% else %}
		<h4>–ü–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π :(</h4>
		<a href="{{ url_for('create_article') }}" class="btn btn-success mt-3">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç–∞—Ç—å—é</a>
		{% endif %}
	</div>
	{% endif %}
</div>
{% endblock %}